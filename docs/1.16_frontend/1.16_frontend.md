# 1.16 - Audit Frontend LMS

> Directive source : `02.Directives/app_factory/phase1/1.16_frontend.md`
> Inputs : 1.03 (User Journey), 1.13 (Panels), 1.08 (Flux)

---

## 1. Choix Framework UI

### EXISTANT

| Question | RÃ©ponse |
|----------|---------|
| Framework CSS utilisÃ© ? | CSS custom pur (pas de framework) |
| Grid ou Flex ? | **Grid** pour layout principal, Flex pour composants |
| Mobile-first ? | âŒ Desktop-first avec media queries breakdowns |
| Theme configurable ? | âœ… CSS variables (`:root`) |
| Multi-langue prÃ©vu ? | âŒ Hardcoded FR |

**DÃ©tails techniques :**

```css
/* styles.css - Layout principal */
.lms-main {
    display: grid;
    grid-template-columns: 280px 1fr 280px;  /* 3 colonnes */
    flex: 1;
}

/* CSS Variables - Theme */
:root {
    --bg-primary: #0a0a0f;
    --accent-primary: #6366f1;
    --font-display: 'Playfair Display', Georgia, serif;
    --font-body: 'DM Sans', -apple-system, sans-serif;
    /* ... 30+ variables dÃ©finies */
}
```

### CIBLE

| Aspect | Valeur |
|--------|--------|
| Layout | Grid âœ… |
| Mobile | Mobile-first |
| Theme | Configurable (CSS vars) âœ… |
| i18n | PrÃ©vu (clÃ©s de traduction) |

### GAP

| ID | Existant | Cible | SÃ©vÃ©ritÃ© |
|----|----------|-------|----------|
| GAP-1601 | Desktop-first (breakpoints: 1200px, 768px) | Mobile-first | P3 |
| GAP-1602 | Textes FR hardcodÃ©s | ClÃ©s i18n | P3 |

---

## 2. Layouts par Page

### EXISTANT

| Page | Layout actuel | Mobile adaptÃ© ? |
|------|---------------|-----------------|
| Welcome | Centre (text-align) + flex stats | âœ… Basique |
| Course Viewer | Step-viewer max-width 900px | âœ… Basique |
| Leaderboard | Liste verticale | âŒ Hidden <1200px |
| Sidebar | Fixed 280px | âŒ Hidden <768px |

**Breakpoints dÃ©finis :**

```css
@media (max-width: 1200px) {
    .lms-main { grid-template-columns: 250px 1fr; }
    .lms-leaderboard { display: none; }
}

@media (max-width: 768px) {
    .lms-main { grid-template-columns: 1fr; }
    .lms-sidebar { display: none; }
}
```

### CIBLE - Wireframes ASCII

**Desktop (>1200px) :**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Logo                    ğŸ”¥ 7d  âš¡ 1250 XP  ğŸ¯ Lvl 5  ğŸ‘¤        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Mon Parcours â”‚                              â”‚ ğŸ† Classement     â”‚
â”‚ â€¢ Module 1 âœ…â”‚   Step 1 / 5                 â”‚ #1 Alice  800 pts â”‚
â”‚ â€¢ Module 2 â—â”‚   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘ 80%              â”‚ #2 Bob    650 pts â”‚
â”‚ â€¢ Module 3  â”‚                               â”‚ #3 Moi    500 pts â”‚
â”‚              â”‚   [VIDEO PLAYER]             â”‚                   â”‚
â”‚ Mes Badges   â”‚                              â”‚                   â”‚
â”‚ ğŸ† ğŸ¯ ğŸ”’ ğŸ”’   â”‚   ğŸ“ Quiz: DÃ©bloquÃ©          â”‚                   â”‚
â”‚              â”‚   [Commencer le quiz]        â”‚                   â”‚
â”‚              â”‚                              â”‚                   â”‚
â”‚              â”‚   â† PrÃ©cÃ©dent   Suivant â†’    â”‚                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Tablet (768px-1200px) :**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Logo                 ğŸ”¥ 7d  âš¡ 1250  ğŸ¯ Lvl 5  ğŸ‘¤  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Mon Parcours â”‚                                      â”‚
â”‚ â€¢ Module 1 âœ…â”‚   Step 1 / 5                         â”‚
â”‚ â€¢ Module 2 â—â”‚   [VIDEO PLAYER]                     â”‚
â”‚              â”‚                                      â”‚
â”‚ Mes Badges   â”‚   ğŸ“ Quiz + Navigation               â”‚
â”‚ ğŸ† ğŸ¯ ğŸ”’ ğŸ”’   â”‚                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
(Leaderboard cachÃ©)
```

**Mobile (<768px) :**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Logo      ğŸ”¥ âš¡ ğŸ¯ ğŸ‘¤       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Step 1 / 5                  â”‚
â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘ 80%              â”‚
â”‚                             â”‚
â”‚ [VIDEO PLAYER]              â”‚
â”‚                             â”‚
â”‚ ğŸ“ Quiz: DÃ©bloquÃ©           â”‚
â”‚ [Commencer le quiz]         â”‚
â”‚                             â”‚
â”‚ â† PrÃ©cÃ©dent   Suivant â†’     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
(Sidebar = hamburger menu)
```

### GAP

| ID | Existant | Cible | SÃ©vÃ©ritÃ© |
|----|----------|-------|----------|
| GAP-1603 | Sidebar/Leaderboard cachÃ©s sans alternative | Menu hamburger mobile | P2 |
| GAP-1604 | Pas de navigation alternative mobile | Bottom nav ou hamburger | P2 |

---

## 3. Composants

### EXISTANT

| Composant | Fichier | Lignes | RÃ©utilisable ? |
|-----------|---------|--------|----------------|
| state.js | `app/state.js` | 104 | âœ… Pattern pub/sub |
| api.js | `app/api.js` | 45 | âœ… Fetch wrapper |
| navigation.js | `app/course/navigation.js` | 88 | âœ… |
| renderer.js | `app/course/renderer.js` | 267 | âš ï¸ Limite |
| tracking.js | `app/video/tracking.js` | 182 | âœ… |
| handler.js | `app/quiz/handler.js` | 160 | âœ… |
| leaderboard.js | `app/leaderboard.js` | 42 | âœ… |
| notifications.js | `app/notifications.js` | 104 | âœ… |
| userStats.js | `app/ui/userStats.js` | 41 | âœ… |
| badges.js | `app/ui/badges.js` | 86 | âœ… |
| courseList.js | `app/ui/courseList.js` | 38 | âœ… |
| toast.js | `components/toast.js` | 81 | âœ… Standalone IIFE |
| endScreen.js | `app/course/endScreen.js` | ~50 | âœ… |
| loader.js | `app/course/loader.js` | 70 | âœ… |
| utils.js | `app/utils.js` | 14 | âœ… |

**Red flags analysÃ©s :**

- [x] Composant > 300 lignes : âŒ **Aucun** (max = renderer.js 267)
- [x] Logique mÃ©tier dans le composant : âš ï¸ **`renderer.js`** calcule les Ã©tats quiz
- [x] Composant non rÃ©utilisable : âŒ Tous rÃ©utilisables

**Arborescence JS actuelle :**

```
app/
â”œâ”€â”€ index.js        # Entry point + orchestration
â”œâ”€â”€ state.js        # Reactive state (pub/sub)
â”œâ”€â”€ api.js          # Fetch wrapper
â”œâ”€â”€ utils.js        # formatNumber()
â”œâ”€â”€ notifications.js
â”œâ”€â”€ leaderboard.js
â”œâ”€â”€ course/
â”‚   â”œâ”€â”€ loader.js   # loadCourse(), refreshSignals()
â”‚   â”œâ”€â”€ renderer.js # renderCurrentStep() âš ï¸ 267 lignes
â”‚   â”œâ”€â”€ navigation.js
â”‚   â””â”€â”€ endScreen.js
â”œâ”€â”€ video/
â”‚   â””â”€â”€ tracking.js # Stream SDK integration
â”œâ”€â”€ quiz/
â”‚   â””â”€â”€ handler.js  # Tally postMessage
â””â”€â”€ ui/
    â”œâ”€â”€ userStats.js
    â”œâ”€â”€ badges.js
    â””â”€â”€ courseList.js
```

### CIBLE

- Tous les composants < 300 lignes âœ… (renderer.js = 267)
- Logique mÃ©tier â†’ API âš ï¸ (quelques calculs UI restent)
- Composants rÃ©utilisables identifiÃ©s âœ…

### GAP

| ID | Existant | Cible | SÃ©vÃ©ritÃ© |
|----|----------|-------|----------|
| GAP-1605 | renderer.js 267 lignes (proche limite) | < 250 lignes | P3 |
| GAP-1606 | Calculs quiz state dans renderer | DÃ©lÃ©guer Ã  signals API | P3 |

---

## 4. Events DOM

### EXISTANT

| Event | Ã‰lÃ©ment | Action | Appel API ? |
|-------|---------|--------|-------------|
| click | `#somList a[data-som-id]` | `loadCourse()` | âœ… GET /courses/:id |
| click | `.leaderboard-tabs .tab` | `loadLeaderboard()` | âœ… GET /leaderboard |
| click | `.nav-btn.next` | `nextStep()` | âœ… GET /signals/:id |
| click | `.quiz-start-btn` | `showQuiz()` | âŒ (Tally embed) |
| message | window | `handleTallySubmission()` | âœ… POST /quiz |
| play/pause | Stream SDK | `sendVideoEvent()` | âœ… POST /events |
| timeupdate | Stream SDK | `sendVideoPing()` | âœ… POST /events (10s) |
| beforeunload | window | `stopVideoTracking()` | âŒ |
| visibilitychange | document | `pauseVideo()` | âŒ |
| lms:xp-earned | window | `showToast()` | âŒ (interne) |
| lms:badge-earned | window | `showBadgeModal()` | âŒ (interne) |

**Event delegation utilisÃ©e :**

```javascript
// index.js - Delegation sur #somList
document.getElementById('somList')?.addEventListener('click', (e) => {
    if (e.target.matches('a[data-som-id]')) {
        e.preventDefault();
        loadCourse(e.target.dataset.somId);
    }
});
```

### CIBLE

- Tous les events mappÃ©s âœ…
- Actions clairement identifiÃ©es âœ…
- Appels API documentÃ©s âœ…

### GAP

| ID | Existant | Cible | SÃ©vÃ©ritÃ© |
|----|----------|-------|----------|
| *(Aucun)* | Events bien structurÃ©s | - | - |

---

## 5. FragilitÃ©s

### EXISTANT

| FragilitÃ© | Description | Impact |
|-----------|-------------|--------|
| Tally postMessage | DÃ©pend du format Tally (peut changer) | Moyen |
| Stream SDK global | `Stream()` doit Ãªtre chargÃ© avant app | Faible |
| window.showQuiz | ExposÃ© globalement (onclick inline) | Faible |
| innerHTML massif | renderer.js construit HTML via template strings | Moyen |

**Analyse des fragilitÃ©s IA :**

1. **Eventing DOM complexe** : âŒ Non - Pattern simple (delegation + custom events)
2. **SÃ©quentialitÃ©** : âœ… LINEAR FIRST respectÃ© - Pas de branches
3. **Ã‰tats UI multiples** : âš ï¸ Quiz a 5 Ã©tats (locked, ready, pending, passed, failed)

### CIBLE

- FragilitÃ©s identifiÃ©es âœ…
- Mitigations documentÃ©es âœ…
- ComplexitÃ© encapsulÃ©e dans "UI engines" âš ï¸ (quiz handler = proto-engine)

### GAP

| ID | Existant | Cible | SÃ©vÃ©ritÃ© |
|----|----------|-------|----------|
| GAP-1607 | onclick="window.showQuiz(...)" inline | Event delegation | P3 |
| GAP-1608 | innerHTML template strings | lit-html ou template tags | P3 |

---

## 6. Logging Frontend

### EXISTANT

| Point | LoggÃ© ? | Niveau |
|-------|---------|--------|
| API calls | âœ… | console.log() |
| Erreurs | âœ… | console.error() |
| Navigation | âŒ | - |
| Video events | âœ… | console.log() avec emoji |
| Quiz events | âœ… | console.log() avec [DEBUG] |

**Exemples de logs existants :**

```javascript
// video/tracking.js
console.log('ğŸ¬ Setting up video tracking for step', stepIndex);
console.log('ğŸ“Š VIDEO_PING: 120s / 300s (40%)');

// quiz/handler.js  
console.log('ğŸ“‹ [DEBUG] currentQuizInfo:', currentQuizInfo);
console.log('ğŸ“¤ [DEBUG] Calling /api/quiz with payload:', payload);
```

### CIBLE

| Point | LoggÃ© ? | Niveau |
|-------|---------|--------|
| API calls | âœ… | INFO |
| Erreurs | âœ… | ERROR |
| Navigation | âœ… | DEBUG |
| Events DOM | âŒ | (trop verbeux) |

### GAP

| ID | Existant | Cible | SÃ©vÃ©ritÃ© |
|----|----------|-------|----------|
| GAP-1609 | console.log() brut | SystÃ¨me de logging avec niveaux | P3 |
| GAP-1610 | Pas de tracking navigation | Log des changements de route | P3 |

---

## 7. CSS & Animations

### EXISTANT - ProblÃ¨mes

| Aspect | Ã‰tat actuel | ProblÃ¨me |
|--------|-------------|----------|
| Structure CSS | Fichiers Ã  la racine (`styles.css`, `animations.css`) | âŒ Pas de dossier `styles/` ou `theme/` |
| styles.css | **1,348 lignes** monolithique | âŒ Devrait Ãªtre dÃ©coupÃ© |
| Design tokens | Variables dans `:root` du mÃªme fichier | âŒ Pas de fichier `tokens.css` sÃ©parÃ© |
| Theming | Couleurs dark hardcodÃ©es | âŒ Pas de mÃ©canisme switch (`[data-theme]`, `.dark`) |
| animations.css | 337 lignes Ã  la racine | âš ï¸ Devrait Ãªtre dans `styles/` |
| Reduced motion | `@media (prefers-reduced-motion)` | âœ… OK |
| Focus states | Outline 2px sur boutons/liens | âœ… OK |

**Structure actuelle (âŒ Non conforme) :**

```
frontend/
â”œâ”€â”€ styles.css          # 1,348 lignes - MONOLITHIQUE
â”œâ”€â”€ animations.css      # 337 lignes - Ã€ la racine
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ toast.css       # OK - rangÃ©
â”‚   â””â”€â”€ tooltip.css     # OK - rangÃ©
â””â”€â”€ ...
```

**Variables actuelles (mÃ©langÃ©es dans styles.css) :**

```css
:root {
    /* Couleurs dark HARDCODÃ‰ES - pas de switch possible */
    --bg-primary: #0a0a0f;
    --bg-secondary: #12121a;
    /* ... */
}
/* Pas de [data-theme="light"] ni .dark class */
```

### CIBLE - Structure recommandÃ©e

```
frontend/
â”œâ”€â”€ styles/
â”‚   â”œâ”€â”€ tokens.css      # Design tokens (couleurs, spacing, fonts)
â”‚   â”œâ”€â”€ base.css        # Reset, body, html
â”‚   â”œâ”€â”€ layout.css      # Grid, header, sidebar, main
â”‚   â”œâ”€â”€ components/     # Par composant
â”‚   â”‚   â”œâ”€â”€ button.css
â”‚   â”‚   â”œâ”€â”€ card.css
â”‚   â”‚   â”œâ”€â”€ toast.css
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”œâ”€â”€ animations.css
â”‚   â””â”€â”€ utilities.css   # Classes utilitaires
â””â”€â”€ ...
```

**Theming cible :**

```css
/* tokens.css */
:root {
    --bg-primary: #ffffff;
    --text-primary: #1a1a1a;
}

[data-theme="dark"] {
    --bg-primary: #0a0a0f;
    --text-primary: #f0f0f5;
}
```

### GAP

| ID | Existant | Cible | SÃ©vÃ©ritÃ© |
|----|----------|-------|----------|
| GAP-1611 | Couleurs dark hardcodÃ©es | MÃ©canisme theming (`[data-theme]`) | P2 |
| GAP-1612 | CSS Ã  la racine en vrac | Dossier `styles/` structurÃ© | P2 |
| GAP-1613 | Variables dans styles.css | Fichier `tokens.css` sÃ©parÃ© | P2 |
| GAP-1614 | styles.css 1,348 lignes | DÃ©couper en fichiers < 300 lignes | P2 |
| GAP-1615 | animations.css Ã  la racine | Dans `styles/animations.css` | P3 |

---

## 8. RÃ©capitulatif des GAPs Frontend

### Par sÃ©vÃ©ritÃ©

| SÃ©vÃ©ritÃ© | Count | IDs |
|----------|-------|-----|
| **P1** | 0 | - |
| **P2** | 6 | GAP-1603, GAP-1604, GAP-1611, GAP-1612, GAP-1613, GAP-1614 |
| **P3** | 9 | GAP-1601, GAP-1602, GAP-1605, GAP-1606, GAP-1607, GAP-1608, GAP-1609, GAP-1610, GAP-1615 |

### Total : 15 GAPs (0 P1, 6 P2, 9 P3)

### Vue consolidÃ©e

| ID | GAP | Existant | Cible | SÃ©vÃ©ritÃ© |
|----|-----|----------|-------|----------|
| GAP-1601 | Mobile approach | Desktop-first | Mobile-first | P3 |
| GAP-1602 | i18n | Textes FR hardcodÃ©s | ClÃ©s traduction | P3 |
| GAP-1603 | Mobile navigation | Sidebar cachÃ©e | Menu hamburger | P2 |
| GAP-1604 | Alternative nav mobile | Aucune | Bottom nav | P2 |
| GAP-1605 | renderer.js size | 267 lignes | < 250 lignes | P3 |
| GAP-1606 | Calculs quiz | Dans renderer | Via API signals | P3 |
| GAP-1607 | onclick inline | window.showQuiz() | Event delegation | P3 |
| GAP-1608 | Template HTML | innerHTML strings | lit-html / template | P3 |
| GAP-1609 | Logging | console.log brut | SystÃ¨me avec niveaux | P3 |
| GAP-1610 | Nav tracking | Non loggÃ© | Log routes | P3 |
| GAP-1611 | **Theming** | Couleurs dark hardcodÃ©es | MÃ©canisme `[data-theme]` | **P2** |
| GAP-1612 | **Structure CSS** | Fichiers en vrac racine | Dossier `styles/` | **P2** |
| GAP-1613 | **Design tokens** | Variables dans styles.css | Fichier `tokens.css` | **P2** |
| GAP-1614 | **CSS monolithique** | styles.css 1,348 lignes | DÃ©couper < 300 lignes | **P2** |
| GAP-1615 | animations.css | Ã€ la racine | Dans `styles/` | P3 |

---

## 9. Bilan

### Points Positifs (JS)

1. **Architecture JS modulaire** : 15 fichiers organisÃ©s par domaine
2. **State management** : Pattern pub/sub simple et efficace
3. **Composants JS < 300 lignes** : Tous respectent la limite
4. **Event delegation** : UtilisÃ©e correctement
5. **LINEAR FIRST** : Navigation strictement linÃ©aire
6. **AccessibilitÃ©** : Focus states et reduced-motion

### Points NÃ©gatifs (CSS)

1. âŒ **CSS non structurÃ©** : Fichiers en vrac Ã  la racine
2. âŒ **styles.css monolithique** : 1,348 lignes (!), devrait Ãªtre < 300
3. âŒ **Pas de theming** : Couleurs dark hardcodÃ©es, pas de switch possible
4. âŒ **Pas de tokens** : Design tokens mÃ©langÃ©s avec les styles
5. âŒ **Pas de dossier styles/** : Conventions non respectÃ©es

### MÃ©triques clÃ©s

| MÃ©trique | Valeur | Status |
|----------|--------|--------|
| Total lignes JS | ~1,300 | âœ… Raisonnable |
| Plus gros fichier JS | renderer.js (267) | âœ… < 300 |
| **styles.css** | **1,348 lignes** | âŒ **MONOLITHIQUE** |
| animations.css | 337 lignes | âš ï¸ Ã€ la racine |
| Endpoints appelÃ©s | 7 | âœ… DocumentÃ©s |
| Events DOM | 11 types | âœ… MappÃ©s |

---

*CrÃ©Ã© le : 2024-12-28*
*Mis Ã  jour : 2024-12-28 - Ajout GAPs CSS/Theming*

