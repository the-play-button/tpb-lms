# 1.11 - Debug Ready LMS

## 1. Audit Logging Existant

### Backend (worker_api/)

| Fichier | Logs | Type | Format |
|---------|------|------|--------|
| index.js | `console.error` | Error | Message brut |
| auth.js | `console.error` | Error | Message brut |
| handlers/events.js | `console.error` | Error | Message brut |
| handlers/quiz.js | `console.log/error` | Mixed | Emojis + message |
| projections/engine.js | `console.log/error` | Mixed | Emojis + message |

**Total backend**: 9 logs

### Frontend (frontend/)

| Fichier | Logs | Type | Format |
|---------|------|------|--------|
| index.js | 3 | Mixed | Emojis |
| video/tracking.js | 12 | Mixed | Emojis |
| quiz/handler.js | 9 | Mixed | Emojis + DEBUG |
| course/loader.js | 2 | Error/warn | Message |
| player_embed.js | 8 | Mixed | Prefix + message |
| Autres | 6 | Mixed | Vari√© |

**Total frontend**: 40 logs

---

## 2. Analyse vs Standard TPB

### Format Cible

```
[TIMESTAMP] [LEVEL] [COMPONENT] Message
```

### Probl√®mes Identifi√©s

| Probl√®me | Impact | Fr√©quence |
|----------|--------|-----------|
| Pas de timestamp | Debug difficile | 100% |
| Pas de niveau (INFO/WARN/ERROR) | Filtrage impossible | ~60% |
| Emojis inconsistants | Parsing difficile | ~70% |
| `[DEBUG]` inline au lieu de level | Inconsistant | ~10% |
| Pas de component tag | Localisation difficile | 100% |

---

## 3. Points Debug par Feature (de 1.10)

### Video Tracking

| Point | Fichier | Log actuel | Suffisant |
|-------|---------|------------|-----------|
| Event envoy√© | video/tracking.js:117 | `üì§ ${eventType} sent` | ‚úÖ |
| Video completed | video/tracking.js:122 | `‚úÖ Video completed!` | ‚úÖ |
| Error send | video/tracking.js:131 | `Failed to send` | ‚ö†Ô∏è pas de d√©tail |

### Quiz

| Point | Fichier | Log actuel | Suffisant |
|-------|---------|------------|-----------|
| Submit re√ßu | quiz/handler.js:62 | `üìã Quiz Tally submitted!` | ‚úÖ |
| API call | quiz/handler.js:84 | `üì§ Calling /api/quiz` | ‚úÖ |
| Response | quiz/handler.js:87 | `üì• Quiz API response` | ‚úÖ |
| Error | quiz/handler.js:109 | `‚ùå Failed to submit` | ‚ö†Ô∏è |

### Projections

| Point | Fichier | Log actuel | Suffisant |
|-------|---------|------------|-----------|
| Success | engine.js:53 | `‚úÖ Projection: video_completed=X` | ‚úÖ |
| Error | engine.js:55 | `‚ùå Projection failed` | ‚ö†Ô∏è |

### Auth

| Point | Fichier | Log actuel | Suffisant |
|-------|---------|------------|-----------|
| JWT error | auth.js:124 | `JWT verification error` | ‚ö†Ô∏è pas de contexte |

---

## 4. Logging Cible

### Backend Standard

```javascript
// Propos√©
const log = (level, component, message, data = {}) => {
    console.log(JSON.stringify({
        ts: new Date().toISOString(),
        level,
        component,
        message,
        ...data
    }));
};

// Usage
log('INFO', 'events', 'Event received', { type: 'VIDEO_PING', user_id });
log('ERROR', 'auth', 'JWT verification failed', { error: error.message });
```

### Frontend Standard

```javascript
// Propos√©
const log = (level, component, message, data) => {
    const prefix = `[${level}][${component}]`;
    console.log(prefix, message, data || '');
};

// Usage
log('INFO', 'video', 'Event sent', { type, position });
log('ERROR', 'quiz', 'Submission failed', { error });
```

---

## 5. Session Recording (TODO)

| Fonctionnalit√© | Status | Outil |
|----------------|--------|-------|
| Front recording | ‚ùå | Requestly? |
| Back events capture | ‚ùå | √Ä d√©velopper |
| Sequence auto-gen | ‚ùå | √Ä d√©velopper |

---

## 6. GAPs

| ID | Composant | Existant | Cible | S√©v√©rit√© |
|----|-----------|----------|-------|----------|
| GAP-1101 | Backend | console.log brut | JSON structur√© | P2 |
| GAP-1102 | Frontend | Emojis inconsistants | Format standardis√© | P3 |
| GAP-1103 | Auth | Pas de contexte | User + endpoint | P2 |
| GAP-1104 | Projections | Error sans stack | Stack trace | P2 |
| GAP-1105 | Session recording | ‚ùå | Outil TPB | P2 |
| GAP-1106 | Tracing | Pas de trace ID | Header x-trace-id + corr√©lation front/back | P2 |

**Nouveau GAP identifi√©** :
- Tracing : actuellement aucune corr√©lation entre les logs d'une m√™me requ√™te. √Ä ajouter : g√©n√©ration d'un `x-trace-id` par requ√™te, propagation dans tous les logs, corr√©lation front‚Üîback.

---

*Cr√©√© le : 2024-12-28*

