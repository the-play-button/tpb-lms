# Gap Analysis - TPB LMS

> Synthèse des écarts de conformité identifiés lors de la Phase 1.
> Ce document consolide tous les GAPs et planifie les actions correctives.

## GAPs Techniques (Framework TPB)

### GAP-001 : Arborescence non conforme
- **Étape** : 1.09
- **Sévérité** : P1
- **Description** : Structure ne suit pas le standard (backend/, frontend/, db/, docs/, scripts/)
- **État actuel** : Fichiers à la racine (schema.sql, etc.), pas de dossier scripts/
- **Action corrective** : Réorganiser l'arborescence (voir détails GAP-901→905)
- **Phase cible** : Phase 2

### GAP-901 : Renommer worker_api/ → backend/
- **Étape** : 1.09
- **Sévérité** : P1
- **Description** : Dossier backend doit s'appeler backend/, pas worker_api/
- **Phase cible** : Phase 2

### GAP-902 : Créer db/ et déplacer schema.sql
- **Étape** : 1.09
- **Sévérité** : P1
- **Description** : schema.sql à la racine, doit être dans db/
- **Phase cible** : Phase 2

### GAP-903 : Créer scripts/
- **Étape** : 1.09
- **Sévérité** : P1
- **Description** : Dossier scripts/ manquant, *.py à la racine
- **Phase cible** : Phase 2

### GAP-904 : Déplacer tests/ → scripts/tests/
- **Étape** : 1.09
- **Sévérité** : P1
- **Description** : tests/ à la racine, doit être dans scripts/tests/
- **Phase cible** : Phase 2

### GAP-905 : Créer scripts/devops/ et déplacer deploy.sh
- **Étape** : 1.09
- **Sévérité** : P1
- **Description** : deploy.sh à la racine, doit être dans scripts/devops/
- **Phase cible** : Phase 2

### ~~GAP-002 : Auth~~ ✅ RÉSOLU
- **Étape** : 1.12
- **Status** : ✅ Cloudflare Access + JWT verification implémentés
- **Détails** : `verifyAccessJWT()`, `getOrCreateContact()`, protected endpoints

### ~~GAP-003 : Routing~~ ✅ RÉSOLU
- **Étape** : 1.03
- **Status** : ✅ Déjà implémenté via `?som=courseId` + `history.pushState`
- **Resume** : ✅ Fonctionne via `signals.can_access_step`

### GAP-004 : Pas de mode dry-run
- **Étape** : 1.07
- **Sévérité** : P3
- **Description** : Endpoints n'ont pas de mode dry-run pour tests
- **Action corrective** : Ajouter ?dry_run=true sur endpoints avec side-effects
- **Phase cible** : Phase 5

### GAP-401 : SDK TPB Events non utilisé
- **Étape** : 1.04
- **Sévérité** : P2
- **Description** : Implémentation custom au lieu du SDK `tpb_events/`
- **Action corrective** : Refactoriser pour consommer le SDK standard
- **Phase cible** : Phase 3

### GAP-402 : Eventual Consistency non documentée
- **Étape** : 1.04
- **Sévérité** : P3
- **Description** : Pas de stratégie de retry/réconciliation si projection échoue
- **Phase cible** : Phase 3

### GAP-403 : Event Versioning manquant
- **Étape** : 1.04
- **Sévérité** : P3
- **Description** : Pas de stratégie de versioning des events (suffixe _V2, upcaster, etc.)
- **Phase cible** : Phase 3

### GAP-404 : Event Replay non documenté
- **Étape** : 1.04
- **Sévérité** : P3
- **Description** : Capacité de replay non testée/documentée
- **Phase cible** : Phase 3

### GAP-405 : Domain vs Integration Events non distingués
- **Étape** : 1.04
- **Sévérité** : P3
- **Description** : Pas de distinction formelle entre events internes et events contrat
- **Phase cible** : Phase 3

### GAP-203 : Pas d'URL par step (nice-to-have)
- **Étape** : 1.03
- **Sévérité** : P3
- **Description** : Step pas dans URL, mais resume fonctionne via `signals.can_access_step`
- **Action corrective** : Ajouter `?som=X&step=3` (optionnel)
- **Phase cible** : Phase 4

### GAP-501 : Pas de organization_id (mode agence)
- **Étape** : 1.05
- **Sévérité** : P3
- **Description** : Pas de multi-organisation, single-tenant
- **Phase cible** : V3+

### GAP-502 : Pas de multi-locale
- **Étape** : 1.05
- **Sévérité** : P3
- **Description** : Hardcodé FR, pas de i18n
- **Phase cible** : V3+

### ~~GAP-503~~ → Remplacé par GAP-1205/1206/1207
- **Status** : Remplacé - utiliser tables LMS Unified.to (lms_student, lms_instructor)

### GAP-1205 : Table lms_student manquante
- **Étape** : 1.05
- **Sévérité** : P1
- **Description** : Créer table lms_student (Unified.to LmsStudent)
- **Phase cible** : Phase 3

### GAP-1206 : Table lms_instructor manquante
- **Étape** : 1.05
- **Sévérité** : P1
- **Description** : Créer table lms_instructor (Unified.to LmsInstructor)
- **Phase cible** : Phase 3

### GAP-1207 : Migration crm_contact → lms_student
- **Étape** : 1.05
- **Sévérité** : P1
- **Description** : Migrer données crm_contact vers lms_student, supprimer CRM/HRIS du scope
- **Phase cible** : Phase 3

### GAP-601 : Vue v_course_progress manquante
- **Étape** : 1.06
- **Sévérité** : P1
- **Description** : % complétion par user/course
- **Phase cible** : Phase 3

### GAP-602 : Vue v_course_mastery manquante
- **Étape** : 1.06
- **Sévérité** : P1
- **Description** : Agrégat mastery par cours
- **Phase cible** : Phase 3

### GAP-603 : Vue v_skill_mastery manquante
- **Étape** : 1.06
- **Sévérité** : P1
- **Description** : Progress 0→100% par skill
- **Phase cible** : Phase 3

### GAP-604 : Vue v_admin_overview manquante
- **Étape** : 1.06
- **Sévérité** : P1
- **Description** : Stats students pour admin dashboard
- **Phase cible** : Phase 3

### GAP-605 : Vue v_streak_history manquante
- **Étape** : 1.06
- **Sévérité** : P2
- **Description** : Historique streaks pour calendar
- **Phase cible** : Phase 3

### GAP-606 : Vue v_video_analytics manquante
- **Étape** : 1.06
- **Sévérité** : P2
- **Description** : Engagement, drop-off points
- **Phase cible** : Phase 3

### GAP-701 : CRUD courses complet manquant
- **Étape** : 1.07
- **Sévérité** : P2
- **Description** : POST/PUT/DELETE sur courses
- **Phase cible** : Phase 3

### GAP-702 : CRUD classes manquant
- **Étape** : 1.07
- **Sévérité** : P2
- **Description** : CRUD complet sur classes
- **Phase cible** : Phase 3

### GAP-703 : CRUD badges manquant
- **Étape** : 1.07
- **Sévérité** : P2
- **Description** : POST/PUT/DELETE sur badges
- **Phase cible** : Phase 3

### GAP-705 : Endpoint front_dashboard manquant
- **Étape** : 1.07
- **Sévérité** : P1
- **Description** : Données agrégées user dashboard
- **Phase cible** : Phase 3

### GAP-706 : Endpoint front_admin manquant
- **Étape** : 1.07
- **Sévérité** : P1
- **Description** : Données agrégées admin dashboard
- **Phase cible** : Phase 3

### GAP-707 : Endpoint front_mastery manquant
- **Étape** : 1.07
- **Sévérité** : P1
- **Description** : Calcul mastery % par cours
- **Phase cible** : Phase 3

### GAP-708 : Job streak_check manquant
- **Étape** : 1.07
- **Sévérité** : P2
- **Description** : Calcul streaks quotidien (cron)
- **Phase cible** : Phase 3

### GAP-710 : Input Validation manquante
- **Étape** : 1.07
- **Sévérité** : P2
- **Description** : Pas de schéma Zod/JSON Schema sur les endpoints
- **Action corrective** : Ajouter validation formelle avec Zod sur tous les inputs
- **Phase cible** : Phase 3

### GAP-711 : Idempotency manquante
- **Étape** : 1.07
- **Sévérité** : P2
- **Description** : POST /events non idempotent (double submit possible)
- **Action corrective** : Ajouter header X-Idempotency-Key avec cache réponse
- **Phase cible** : Phase 3

### GAP-801 : Flux front_dashboard manquant
- **Étape** : 1.08
- **Sévérité** : P1
- **Description** : Flux complet user dashboard (front → API → vues)
- **Phase cible** : Phase 4

### GAP-802 : Flux front_admin manquant
- **Étape** : 1.08
- **Sévérité** : P1
- **Description** : Flux complet admin dashboard
- **Phase cible** : Phase 4

### GAP-803 : Flux cron streak manquant
- **Étape** : 1.08
- **Sévérité** : P2
- **Description** : Flux cron → job → signal streak
- **Phase cible** : Phase 3

### GAP-804 : Flux hearts/lives manquant
- **Étape** : 1.08
- **Sévérité** : P2
- **Description** : Flux complet système coeurs
- **Phase cible** : Phase 3

### GAP-805 : Flux mastery manquant
- **Étape** : 1.08
- **Sévérité** : P1
- **Description** : Flux front mastery.js + back front_mastery.js
- **Phase cible** : Phase 4

### GAP-806 : Table hearts manquante
- **Étape** : 1.08
- **Sévérité** : P2
- **Description** : Table pour stocker les coeurs/vies
- **Phase cible** : Phase 3

### GAP-1001 : Séquence user dashboard manquante
- **Étape** : 1.10
- **Sévérité** : P1
- **Description** : Flux complet front→back→views pour dashboard user
- **Phase cible** : Phase 4

### GAP-1002 : Séquence admin dashboard manquante
- **Étape** : 1.10
- **Sévérité** : P1
- **Description** : Flux complet front→back→views pour dashboard admin
- **Phase cible** : Phase 4

### GAP-1003 : Séquence streak cron manquante
- **Étape** : 1.10
- **Sévérité** : P2
- **Description** : Job daily + signal streak
- **Phase cible** : Phase 3

### GAP-1004 : Séquence hearts decrement manquante
- **Étape** : 1.10
- **Sévérité** : P2
- **Description** : Projection + update hearts on quiz fail
- **Phase cible** : Phase 3

### GAP-1005 : Course loading non optimisé
- **Étape** : 1.10
- **Sévérité** : P3
- **Description** : 2 API calls (courses + signals) pourraient être fusionnés
- **Phase cible** : Phase 4

### GAP-1101 : Backend logs non structurés
- **Étape** : 1.11
- **Sévérité** : P2
- **Description** : console.log brut → JSON structuré avec timestamp/level/component
- **Phase cible** : Phase 3

### ~~GAP-1102 : Frontend logs inconsistants~~ ✅ RÉSOLU
- **Étape** : 1.11
- **Status** : ✅ `frontend/utils/log.js` créé avec DEBUG_MODE
- **Détails** : Logger standardisé avec niveaux (debug/info/warn/error), suppression auto en prod

### GAP-1103 : Auth logs sans contexte
- **Étape** : 1.11
- **Sévérité** : P2
- **Description** : Ajouter user + endpoint dans les logs auth
- **Phase cible** : Phase 3

### GAP-1104 : Projections error sans stack
- **Étape** : 1.11
- **Sévérité** : P2
- **Description** : Inclure stack trace dans les erreurs projection
- **Phase cible** : Phase 3

### GAP-1105 : Session recording manquant
- **Étape** : 1.11
- **Sévérité** : P2
- **Description** : Pas d'outil de capture session front+back
- **Phase cible** : Phase 5

### GAP-1106 : Tracing manquant
- **Étape** : 1.11
- **Sévérité** : P2
- **Description** : Pas de trace ID pour corrélation front↔back
- **Action corrective** : Ajouter header x-trace-id propagé dans tous les logs
- **Phase cible** : Phase 3

### GAP-1201 : Rôles utilisateur manquants
- **Étape** : 1.12
- **Sévérité** : P2
- **Description** : Pas de distinction student/instructor/admin
- **Phase cible** : Phase 3

### GAP-1202 : Matrice permissions manquante
- **Étape** : 1.12
- **Sévérité** : P2
- **Description** : Permissions implicites, pas de config explicite
- **Phase cible** : Phase 3

### GAP-1203 : RBAC enforcement manquant
- **Étape** : 1.12
- **Sévérité** : P2
- **Description** : Pas de middleware vérifiant les rôles
- **Phase cible** : Phase 3

### GAP-1204 : Audit log manquant
- **Étape** : 1.12
- **Sévérité** : P3
- **Description** : Pas de log "qui a fait quoi"
- **Phase cible** : Phase 3

### GAP-1208 : Fonction resolveRole() manquante
- **Étape** : 1.12
- **Sévérité** : P2
- **Description** : Pas de fonction pour résoudre le rôle (student/instructor/admin) depuis l'email
- **Action corrective** : Implémenter pattern IAMPAM (check instructor first, puis student)
- **Phase cible** : Phase 3

### GAP-1209 : Guard middleware manquant
- **Étape** : 1.12
- **Sévérité** : P2
- **Description** : Pas de middleware vérifiant l'intent + rôle avant exécution handler
- **Action corrective** : Implémenter pattern Intent+Guard (voir 1.12_appendix_TPB_IAMPAM.md)
- **Phase cible** : Phase 3

### GAP-1210 : Input Sanitization non formalisée
- **Étape** : 1.12
- **Sévérité** : P2
- **Description** : Pas de checklist formelle de protection (parameterized queries, escape HTML, validation types, limites)
- **Action corrective** : Auditer et documenter les protections existantes + combler les manques
- **Phase cible** : Phase 3

### GAP-1301 : User Settings Panel manquant
- **Étape** : 1.13
- **Sévérité** : P2
- **Description** : Pas de page profil/préférences utilisateur
- **Dépendances** : GAP-1205 (lms_student)
- **Phase cible** : Phase 4

### GAP-1302 : Admin Panel manquant
- **Étape** : 1.13
- **Sévérité** : P1
- **Description** : Pas de dashboard admin (overview, students list, KPIs)
- **Dépendances** : GAP-604 (v_admin_overview), GAP-706 (front_admin)
- **Phase cible** : Phase 4

### GAP-1303 : Beta Panel manquant
- **Étape** : 1.13
- **Sévérité** : P2
- **Description** : Pas d'outils feedback/debug pour beta testeurs
- **Phase cible** : Phase 4

### GAP-1401 : Scripts à la racine
- **Étape** : 1.14
- **Sévérité** : P1
- **Description** : Scripts (reset_db.py, manage_access.py, deploy.sh) à la racine au lieu de scripts/devops/
- **Phase cible** : Phase 2

### GAP-1402 : Pas de verify_deploy
- **Étape** : 1.14
- **Sévérité** : P2
- **Description** : Pas de script smoke tests post-deploy
- **Phase cible** : Phase 2

### GAP-1403 : Pas de check_secrets
- **Étape** : 1.14
- **Sévérité** : P2
- **Description** : Pas de script vérification secrets avant deploy
- **Phase cible** : Phase 2

### GAP-1404 : Pas de check_security
- **Étape** : 1.14
- **Sévérité** : P2
- **Description** : Pas de script audit sécurité basique (headers, CORS)
- **Phase cible** : Phase 2

### GAP-1405 : env.staging incomplet
- **Étape** : 1.14
- **Sévérité** : P2
- **Description** : wrangler.toml env.staging sans database_id ni vars
- **Phase cible** : Phase 2

### GAP-1406 : Pas de headers sécurité
- **Étape** : 1.14
- **Sévérité** : P2
- **Description** : Pas de CSP, HSTS, X-Frame-Options dans les réponses
- **Phase cible** : Phase 2

### GAP-1407 : deploy.sh interactif
- **Étape** : 1.14
- **Sévérité** : P3
- **Description** : Script avec read -p, incompatible CI/CD
- **Phase cible** : Phase 3

### GAP-1408 : Pas de SCALING_TODO.md
- **Étape** : 1.14
- **Sévérité** : P3
- **Description** : Bottlenecks et coûts non documentés
- **Phase cible** : Phase 3

### GAP-1409 : Pas de CI/CD
- **Étape** : 1.14
- **Sévérité** : P3
- **Description** : Pas de GitHub Actions ou équivalent
- **Phase cible** : Phase 3

### GAP-1410 : Pas de beta feedback
- **Étape** : 1.14
- **Sévérité** : P3
- **Description** : Pas de portail feedback beta testeurs
- **Phase cible** : Phase 3

### GAP-1411 : Directives éclatées lms/ + cloudflare/
- **Étape** : 1.14
- **Sévérité** : P1
- **Description** : Directives éparpillées entre 02.Directives/lms/ et 02.Directives/cloudflare/ sans lien explicite
- **Phase cible** : Phase 2

### GAP-1412 : Scripts LMS utilisent 04.Execution/cloudflare/
- **Étape** : 1.14
- **Sévérité** : P1
- **Description** : deploy_workers.py dans cloudflare/ mais utilisé par LMS - dépendance inter-domaines
- **Phase cible** : Phase 2

### GAP-1413 : Docs audit dans 04.Execution/lms/docs/
- **Étape** : 1.14
- **Sévérité** : P1
- **Description** : Documentation d'audit dans Execution au lieu de docs/ à la racine
- **Phase cible** : Phase 2

### GAP-1414 : Mapping directive→script non maintenu
- **Étape** : 1.14
- **Sévérité** : P2
- **Description** : _lms_directive_script_map.md existe mais relations pas à jour
- **Phase cible** : Phase 2

### GAP-1415 : Rate Limiting manquant
- **Étape** : 1.14
- **Sévérité** : P2
- **Description** : Pas de protection rate limiting par IP/user
- **Action corrective** : Ajouter middleware rate limiting avec réponse 429 + Retry-After
- **Phase cible** : Phase 2

### GAP-1501 : Logique dupliquée quiz.js/events.js
- **Étape** : 1.15
- **Sévérité** : P2
- **Description** : quiz.js duplique INSERT lms_event de events.js
- **Action corrective** : Factoriser dans helper commun
- **Phase cible** : Phase 3

### GAP-1502 : Pas de OpenAPI/Swagger
- **Étape** : 1.15
- **Sévérité** : P2
- **Description** : Aucune documentation API formelle
- **Action corrective** : Générer docs/openapi.yaml
- **Phase cible** : Phase 3

### GAP-1503 : Pas de collection Postman
- **Étape** : 1.15
- **Sévérité** : P3
- **Description** : Pas de collection pour tester les endpoints sans frontend
- **Phase cible** : Phase 4

### GAP-1504 : Dossier middleware/ manquant
- **Étape** : 1.15
- **Sévérité** : P2
- **Description** : Pas de dossier middleware/ pour guard.js et rbac.js
- **Action corrective** : Créer backend/middleware/ avec pattern Intent+Guard
- **Phase cible** : Phase 3

### GAP-1601 : Desktop-first approach
- **Étape** : 1.16
- **Sévérité** : P3
- **Description** : CSS desktop-first avec breakpoints descendants au lieu de mobile-first
- **Phase cible** : Phase 4

### GAP-1602 : i18n manquant
- **Étape** : 1.16
- **Sévérité** : P3
- **Description** : Textes FR hardcodés, pas de clés de traduction
- **Phase cible** : V3+

### GAP-1603 : Mobile navigation manquante
- **Étape** : 1.16
- **Sévérité** : P2
- **Description** : Sidebar/Leaderboard cachés sur mobile sans alternative (hamburger menu)
- **Phase cible** : Phase 4

### GAP-1604 : Alternative nav mobile manquante
- **Étape** : 1.16
- **Sévérité** : P2
- **Description** : Pas de bottom nav ou hamburger pour accès mobile
- **Phase cible** : Phase 4

### GAP-1605 : renderer.js proche limite
- **Étape** : 1.16
- **Sévérité** : P3
- **Description** : 267 lignes, proche limite 300 lignes
- **Phase cible** : Phase 4

### GAP-1606 : Calculs quiz dans renderer
- **Étape** : 1.16
- **Sévérité** : P3
- **Description** : États quiz calculés côté frontend, devrait déléguer à signals API
- **Phase cible** : Phase 4

### GAP-1607 : onclick inline
- **Étape** : 1.16
- **Sévérité** : P3
- **Description** : window.showQuiz() via onclick inline, devrait utiliser event delegation
- **Phase cible** : Phase 4

### GAP-1608 : innerHTML template strings
- **Étape** : 1.16
- **Sévérité** : P3
- **Description** : renderer.js utilise innerHTML avec template strings, devrait utiliser lit-html ou template tags
- **Phase cible** : Phase 4

### GAP-1609 : Logging frontend basique
- **Étape** : 1.16
- **Sévérité** : P3
- **Description** : console.log() brut sans système de niveaux (DEBUG/INFO/WARN/ERROR)
- **Phase cible** : Phase 4

### GAP-1610 : Navigation non loggée
- **Étape** : 1.16
- **Sévérité** : P3
- **Description** : Changements de route/cours non tracés dans les logs
- **Phase cible** : Phase 4

### GAP-1611 : Pas de mécanisme theming
- **Étape** : 1.16
- **Sévérité** : P2
- **Description** : Couleurs dark hardcodées, pas de mécanisme switch ([data-theme], .dark class)
- **Phase cible** : Phase 4

### ~~GAP-1612 : Structure CSS non conforme~~ ✅ RÉSOLU
- **Étape** : 1.16
- **Status** : ✅ Dossier `frontend/styles/` créé avec 5 modules CSS
- **Détails** : base.css, layout.css, components.css, course.css, responsive.css

### GAP-1613 : Design tokens non séparés
- **Étape** : 1.16
- **Sévérité** : P2
- **Description** : Variables CSS mélangées dans styles.css au lieu d'un fichier tokens.css dédié
- **Phase cible** : Phase 4

### ~~GAP-1614 : styles.css monolithique~~ ✅ RÉSOLU
- **Étape** : 1.16
- **Status** : ✅ Split en 5 fichiers modulaires (< 600 lignes chacun)
- **Détails** : styles.css = 11 lignes (imports), modules dans styles/

### GAP-1615 : animations.css mal rangé
- **Étape** : 1.16
- **Sévérité** : P3
- **Description** : Fichier à la racine au lieu de styles/animations.css
- **Phase cible** : Phase 4

### GAP-1701 : Cahier de recette manquant
- **Étape** : 1.17
- **Sévérité** : P2
- **Description** : Template dans 1.03, pas de fichier docs/cahier_recette.md dédié
- **Phase cible** : Phase 5

### GAP-1702 : États DB non documentés
- **Étape** : 1.17
- **Sévérité** : P2
- **Description** : Pas d'états DB attendus documentés par step de test
- **Phase cible** : Phase 5

### GAP-1703 : Scénarios incomplets
- **Étape** : 1.17
- **Sévérité** : P2
- **Description** : Seulement 3 scénarios, manque liste P1/P2/P3 complète
- **Phase cible** : Phase 5

### GAP-1704 : Pas de scénarios négatifs
- **Étape** : 1.17
- **Sévérité** : P2
- **Description** : Manque scénarios quiz fail, vidéo incomplète, erreurs
- **Phase cible** : Phase 5

### GAP-1705 : Endpoints legacy maintenus (PARTIEL)
- **Étape** : 1.17
- **Sévérité** : P3
- **Status** : ⚠️ `/api/video-event` supprimé, `/api/quiz` conservé (utilisé par frontend)
- **Détails** : `transformLegacyVideoEvent()` supprimé de index.js

### GAP-1706 : Scripts Python non audités
- **Étape** : 1.17
- **Sévérité** : P3
- **Description** : tally_webhook.py, parse_som.py, sync_tally_quiz.py à auditer
- **Phase cible** : Phase 5

### ~~GAP-1707 : player_embed.js dupliqué~~ ✅ RÉSOLU
- **Étape** : 1.17
- **Status** : ✅ Fichier supprimé (était inutilisé, tracking géré par tracking.js)
- **Détails** : Référence retirée de index.html

### GAP-1708 : Pas de dry-run events
- **Étape** : 1.17
- **Sévérité** : P3
- **Description** : /api/events n'a pas de mode ?dry_run=true
- **Phase cible** : Phase 5

### GAP-1709 : Pas de dry-run quiz
- **Étape** : 1.17
- **Sévérité** : P3
- **Description** : /api/quiz n'a pas de mode ?dry_run=true
- **Phase cible** : Phase 5

### GAP-1710 : test_api.py obsolète
- **Étape** : 1.17
- **Sévérité** : P2
- **Description** : Tests utilisent anciens endpoints (video-event, quiz-submission) au lieu des nouveaux
- **Phase cible** : Phase 5

### GAP-1711 : Pas de collection Postman
- **Étape** : 1.17
- **Sévérité** : P2
- **Description** : Aucune collection pour tester les endpoints sans frontend
- **Phase cible** : Phase 5

### GAP-1712 : Pas de session recording
- **Étape** : 1.17
- **Sévérité** : P3
- **Description** : Requestly non configuré pour session recording
- **Phase cible** : Phase 5

---

## GAPs Features (Inspirations 1.01)

### MUST-HAVE (P1) - Bloquant production

| ID | Feature | Source | Description | Phase |
|----|---------|--------|-------------|-------|
| GAP-101 | Playback speed | Loom | Contrôle vitesse 0.5x→2x | 4 |
| GAP-102 | Resume position vidéo | Wistia | Reprendre vidéo où on s'est arrêté | 3 |
| GAP-104 | **User dashboard** | Tous | Vue "My progress" centrale | 4 |
| GAP-105 | **Course progress card** | LinkedIn | % complétion, resume button | 4 |
| GAP-106 | **Admin dashboard** | Canvas | Vue students, stats engagement | 4 |
| GAP-107 | **Skill mastery %** | Khan | Progress 0→100% par skill | 3 |
| GAP-108 | **Course mastery %** | Khan | % complétion agrégé cours | 3 |

### NICE-TO-HAVE V2 (P2)

| ID | Feature | Source | Description | Phase |
|----|---------|--------|-------------|-------|
| GAP-109 | Streak freeze | Duolingo | Skip 1 jour sans perdre streak | 3 |
| GAP-110 | **Coeurs/Vies** | Duolingo | Perd 1 coeur par erreur quiz, regain via XP/temps | 3 |
| GAP-111 | Streak calendar | Duolingo | Heatmap GitHub-style | 4 |
| GAP-112 | Mastery badges | Khan | Bronze/Silver/Gold/Mastery (25/50/75/100%) | 3 |
| GAP-113 | Skill tree | Khan | Visualisation dépendances | 4 |
| GAP-114 | Chapter markers | Loom | Timestamps cliquables vidéo | 4 |
| GAP-115 | Team dashboard | Lessonly | Manager voit son équipe | 4 |
| GAP-116 | Analytics dashboard | Wistia | Engagement vidéos, drop-off | 4 |
| GAP-117 | Keyboard nav | Linear | Shortcuts power users | 4 |
| GAP-118 | Empty states | Stripe | Onboarding UX | 4 |
| GAP-119 | Reporting exports | Moodle | CSV/PDF progressions | 3 |

### NICE-TO-HAVE V3+ (P3)

| ID | Feature | Source | Phase |
|----|---------|--------|-------|
| GAP-120 | Streak rewards | Duolingo | 3 |
| GAP-121 | Confetti | Duolingo | 4 |
| GAP-122 | Prerequisite lock | Khan | 3 |
| GAP-123 | ELO + Ranking compétitif | Jeux vidéo | 3 |
| GAP-203 | URL par step | 1.03 | 4 |

---

## Features REJETÉES

| Feature | Source | Raison |
|---------|--------|--------|
| League system | Duolingo | Overkill, leaderboard simple suffit |
| Real-time notifs | Slack | Pas de use case temps réel |
| Video heatmap | Wistia | Analytics avancée, V3+ si jamais |

---

## Backlog Priorisé par Phase

### Phase 2 (DevOps)

| ID | GAP | Description | Priorité |
|----|-----|-------------|----------|
| GAP-001 | Arborescence | Réorganiser structure dossiers | P1 |
| GAP-1401 | Scripts à la racine | Déplacer vers scripts/devops/ | P1 |
| GAP-1411 | Directives éclatées | Unifier lms/ + cloudflare/ | P1 |
| GAP-1412 | Scripts inter-domaines | Scripts devops internes au projet | P1 |
| GAP-1413 | Docs mal placées | Déplacer docs/ hors de 04.Execution/ | P1 |
| GAP-1402 | verify_deploy | Script smoke tests post-deploy | P2 |
| GAP-1403 | check_secrets | Script vérification secrets | P2 |
| GAP-1404 | check_security | Script audit sécurité | P2 |
| GAP-1405 | env.staging | Staging fonctionnel avec DB séparée | P2 |
| GAP-1406 | Headers sécurité | CSP, HSTS, X-Frame-Options | P2 |
| GAP-1414 | Mapping directive→script | Relations explicites | P2 |
| GAP-1415 | Rate Limiting | Middleware rate limit par IP/user | P2 |

### Phase 3 (Backend + DevOps P3)

| ID | GAP | Description | Priorité |
|----|-----|-------------|----------|
| GAP-1407 | deploy.sh interactif | Non-interactif pour CI/CD | P3 |
| GAP-1408 | SCALING_TODO.md | Documenter bottlenecks | P3 |
| GAP-1409 | CI/CD | GitHub Actions ou équivalent | P3 |
| GAP-1410 | Beta feedback | Portail feedback beta testeurs | P3 |

### Phase 3 (Backend)

| ID | GAP | Description | Priorité |
|----|-----|-------------|----------|
| GAP-102 | Resume vidéo | Sauvegarder/restaurer position vidéo | P1 |
| GAP-107 | Skill mastery % | Calcul mastery par skill | P1 |
| GAP-108 | Course mastery % | Agrégat complétion cours | P1 |
| GAP-401 | SDK TPB Events | Refacto pour consommer tpb_events/ | P2 |
| GAP-601 | v_course_progress | Vue % complétion user/course | P1 |
| GAP-602 | v_course_mastery | Vue mastery par cours | P1 |
| GAP-603 | v_skill_mastery | Vue progress par skill | P1 |
| GAP-604 | v_admin_overview | Vue stats admin | P1 |
| GAP-605 | v_streak_history | Vue historique streaks | P2 |
| GAP-606 | v_video_analytics | Vue engagement vidéo | P2 |
| GAP-109 | Streak freeze | Endpoint + logique freeze | P2 |
| GAP-110 | Coeurs/Vies | Système coeurs, perte, regain | P2 |
| GAP-112 | Mastery badges | Award badges à 25/50/75/100% | P2 |
| GAP-119 | Reporting exports | Endpoints export CSV/PDF | P2 |
| GAP-701 | CRUD courses | POST/PUT/DELETE courses | P2 |
| GAP-702 | CRUD classes | CRUD complet classes | P2 |
| GAP-703 | CRUD badges | POST/PUT/DELETE badges | P2 |
| GAP-705 | front_dashboard | Endpoint user dashboard | P1 |
| GAP-706 | front_admin | Endpoint admin dashboard | P1 |
| GAP-707 | front_mastery | Endpoint mastery % | P1 |
| GAP-708 | job streak_check | Cron calcul streaks | P2 |
| GAP-1205 | lms_student | Créer table Unified.to | P1 |
| GAP-1206 | lms_instructor | Créer table Unified.to | P1 |
| GAP-1207 | Migration | crm_contact → lms_student | P1 |
| GAP-1201 | Rôles | Distinction student/instructor/admin | P2 |
| GAP-1202 | Matrice permissions | Config explicite | P2 |
| GAP-1203 | RBAC enforcement | Middleware vérifiant rôles | P2 |
| GAP-1208 | resolveRole() | Fonction résolution rôle | P2 |
| GAP-1209 | guard() middleware | Pattern Intent+Guard | P2 |
| GAP-1501 | Logique dupliquée | Factoriser quiz.js/events.js | P2 |
| GAP-1502 | OpenAPI/Swagger | Générer docs/openapi.yaml | P2 |
| GAP-1504 | middleware/ | Créer dossier avec guard.js, rbac.js | P2 |
| GAP-710 | Input Validation | Schémas Zod sur tous les inputs | P2 |
| GAP-711 | Idempotency | Header X-Idempotency-Key | P2 |
| GAP-1106 | Tracing | Header x-trace-id propagé | P2 |
| GAP-1210 | Input Sanitization | Checklist protections | P2 |
| GAP-1204 | Audit log | Log qui a fait quoi | P3 |
| GAP-402 | Eventual Consistency | Stratégie retry/réconciliation | P3 |
| GAP-403 | Event Versioning | Stratégie versioning events | P3 |
| GAP-404 | Event Replay | Documenter capacité replay | P3 |
| GAP-405 | Domain vs Integration | Distinguer events internes/contrat | P3 |

### Phase 4 (Frontend)

| ID | GAP | Description | Priorité |
|----|-----|-------------|----------|
| GAP-101 | Playback speed | UI contrôle vitesse | P1 |
| GAP-104 | **User dashboard** | Page "My progress" | P1 |
| GAP-105 | **Course progress card** | Composant % + resume | P1 |
| GAP-106 | **Admin dashboard** | Page stats students | P1 |
| GAP-111 | Streak calendar | Heatmap component | P2 |
| GAP-113 | Skill tree | Tree visualization | P2 |
| GAP-114 | Chapter markers | UI timestamps vidéo | P2 |
| GAP-115 | Team dashboard | Page manager | P2 |
| GAP-116 | Analytics dashboard | Page engagement | P2 |
| GAP-117 | Keyboard nav | Shortcuts | P2 |
| GAP-118 | Empty states | Onboarding screens | P2 |
| GAP-1301 | User Settings | Page profil/préférences | P2 |
| GAP-1302 | Admin Panel | Dashboard admin complet | P1 |
| GAP-1303 | Beta Panel | Outils feedback/debug | P2 |
| GAP-1503 | Collection Postman | Tester endpoints sans frontend | P3 |
| GAP-1603 | Mobile navigation | Menu hamburger pour mobile | P2 |
| GAP-1604 | Alternative nav mobile | Bottom nav ou hamburger | P2 |
| GAP-1601 | Mobile-first | Refacto CSS mobile-first | P3 |
| GAP-1605 | renderer.js | Réduire à < 250 lignes | P3 |
| GAP-1606 | Quiz state | Déléguer calculs à API signals | P3 |
| GAP-1607 | onclick inline | Event delegation | P3 |
| GAP-1608 | innerHTML | lit-html ou template tags | P3 |
| GAP-1609 | Logging frontend | Système avec niveaux | P3 |
| GAP-1610 | Nav tracking | Log changements de route | P3 |
| GAP-1611 | **Theming** | Mécanisme [data-theme] switch | P2 |
| GAP-1612 | **Structure CSS** | Dossier styles/ structuré | P2 |
| GAP-1613 | **Design tokens** | Fichier tokens.css séparé | P2 |
| GAP-1614 | **CSS monolithique** | Découper styles.css 1348 lignes | P2 |
| GAP-1615 | animations.css | Ranger dans styles/ | P3 |

### Phase 5 (Tests)

| ID | GAP | Description | Priorité |
|----|-----|-------------|----------|
| GAP-004 | Dry-run | Mode test endpoints | P3 |
| GAP-1701 | Cahier de recette | Fichier docs/cahier_recette.md | P2 |
| GAP-1702 | États DB | Documenter états attendus | P2 |
| GAP-1703 | Scénarios | Liste P1/P2/P3 complète | P2 |
| GAP-1704 | Scénarios négatifs | Quiz fail, vidéo incomplète | P2 |
| GAP-1710 | **test_api.py obsolète** | Réécrire avec nouveaux endpoints | P2 |
| GAP-1711 | Collection Postman | Générer depuis 1.07 | P2 |
| GAP-1705 | Endpoints legacy | Supprimer après migration | P3 |
| GAP-1706 | Scripts Python | Auditer tally_webhook.py etc. | P3 |
| GAP-1707 | player_embed.js | Supprimer doublon racine | P3 |
| GAP-1708 | Dry-run events | ?dry_run=true sur /events | P3 |
| GAP-1709 | Dry-run quiz | ?dry_run=true sur /quiz | P3 |
| GAP-1712 | Session recording | Configurer Requestly | P3 |

### V3+ (Nice-to-have)

| ID | GAP | Description | Priorité |
|----|-----|-------------|----------|
| GAP-1602 | i18n | Clés de traduction | P3 |

---

## Comptage GAPs

| Priorité | Count | Resolved | Remaining |
|----------|-------|----------|-----------|
| P1 | 33 | 5 (arborescence) | 28 |
| P2 | 62 | 12 (observabilité, API, sécurité, devops, CSS) | 50 |
| P3 | 32 | 4 (frontend logs, legacy cleanup) | 28 |
| **Total** | **127** | **21** | **106** |

> *Phase 2 Speedrun : 21 GAPs résolus (17%), focus sur tests + entropy reduction*

---

## Notes

- **P1** : Bloquant pour production - MUST FIX
- **P2** : Important pour V2, peut attendre launch
- **P3** : Nice-to-have, V3+

---

*Dernière mise à jour : 2024-12-29*
*Phase 1 terminée - Étapes 1.01 → 1.17 complètes*
*Phase 2 en cours - First Pareto Speedrun (21 GAPs résolus)*
*Focus : Tests E2E, Entropy Reduction, DevOps*
