# TPB Vault Worker
# Infrastructure secrets API with D1 backend
# Deploy: npx wrangler deploy
# Apply schema: npx wrangler d1 execute vault-db --remote --file=db/schema.sql

name = "tpb-vault-infra"
main = "backend/index.js"
compatibility_date = "2024-01-01"

# D1 Database binding
[[d1_databases]]
binding = "DB"
database_name = "vault-db"
database_id = "1cf0c520-b100-43ed-8061-bdda0513d213"

# Cloudflare Access configuration
[vars]
ACCESS_TEAM_DOMAIN = "theplaybutton"

# Bootstrap secrets (set via: wrangler secret put <NAME>):
# Only 2 secrets required:
# - CLOUDFLARE_ACCOUNT_ID: Your Cloudflare account ID
# - CLOUDFLARE_API_TOKEN: API token with permissions:
#     - Workers Scripts: Edit
#     - Access: Service Tokens: Edit
#     - Access: Apps and Policies: Edit
#
# After bootstrap, all other secrets are stored via vault-api itself.

[dev]
port = 8788
local_protocol = "http"
